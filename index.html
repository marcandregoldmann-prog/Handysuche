<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FFB6C1">
    <meta name="description" content="Handy Such-Tracker - Wie oft suchst du dein Handy?">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkhhbmR5IFN1Y2gtVHJhY2tlciIsCiAgInNob3J0X25hbWUiOiAiSGFuZHkgU3VjaGVyIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNGRkY1RTQiLAogICJ0aGVtZV9jb2xvciI6ICIjRkZCNkMxIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlOVFlpSUdobGFXZG9kRDBpTWpVMklqNDhjbVZqZENCM2FXUjBhRDBpTWpVMklpQm9aV2xuYUhROUlqSTFOaUlnWm1sc2JEMGlJMFpHUWpaRE1TSXZQanh6ZG1jZ2VEMGlNVEk0SWlCNVBTSXhNamdpUGp3aGxTMHRJRTFoYm1SaFluUmxJR2xqYjI0Z0xTMCtQSFJsZUhRZ2VEMGlNQ0lnZVQwaU1DSWdabTl1ZEMxemFYcGxQU0k0TUNJZ1ptbHNiRDBpSXpNek15SStmandpOkh5QThMM1JsZUhRK1BDOXpkbWMrUEM5emRtYytUIiwKICAgICAgInNpemVzIjogIjI1NngyNTYiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTFNVElpSUdobGFXZG9kRDBpTlRFeUlqNDhjbVZqZENCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlnWm1sc2JEMGlJMFpHUWpaRE1TSXZQanh6ZG1jZ2VEMGlNalUySWlCNVBTSXlOVFlpUGp3aGxTMHRJRTFoYm1SaFluUmxJR2xqYjI0Z0xTMCtQSFJsZUhRZ2VEMGlNQ0lnZVQwaU1DSWdabTl1ZEMxemFYcGxQU0l4TmpBaUlHWnBiR3c5SWlNek16TWlQbjU4ZnlBOEwzUmxlSFErUEM5emRtYytQQzl6ZG1jKyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTYiIGhlaWdodD0iMjU2Ij48cmVjdCB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgZmlsbD0iI0ZGQjZDMSIvPjxzdmcgeD0iMTI4IiB5PSIxMjgiPjwhLS0gTWFuZGF0ZSBpY29uIC0tPjx0ZXh0IHg9IjAiIHk9IjAiIGZvbnQtc2l6ZT0iODAiIGZpbGw9IiMzMzMiPvCfkpc8L3RleHQ+PC9zdmc+PC9zdmc+">
    <title>Handy Such-Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #FFF5E4 0%, #FFE5EC 100%);
            min-height: 100vh;
            padding: 20px;
        }
        #root {
            max-width: 500px;
            margin: 0 auto;
        }
        .install-banner {
            background: #FFB6C1;
            color: #333;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .install-banner button {
            background: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }
        .install-banner button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [count, setCount] = useState(0);
            const [history, setHistory] = useState([]);
            const [showStats, setShowStats] = useState(false);
            const [showAchievement, setShowAchievement] = useState(null);
            const [installPrompt, setInstallPrompt] = useState(null);

            // Load data from localStorage
            useEffect(() => {
                const savedCount = localStorage.getItem('searchCount');
                const savedHistory = localStorage.getItem('searchHistory');
                if (savedCount) setCount(parseInt(savedCount));
                if (savedHistory) setHistory(JSON.parse(savedHistory));
            }, []);

            // Save data to localStorage
            useEffect(() => {
                localStorage.setItem('searchCount', count.toString());
                localStorage.setItem('searchHistory', JSON.stringify(history));
            }, [count, history]);

            // PWA Install prompt
            useEffect(() => {
                const handler = (e) => {
                    e.preventDefault();
                    setInstallPrompt(e);
                };
                window.addEventListener('beforeinstallprompt', handler);
                return () => window.removeEventListener('beforeinstallprompt', handler);
            }, []);

            const playSound = () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            };

            const checkAchievements = (newCount) => {
                const achievements = {
                    1: { title: "Erster Fail! üéâ", text: "Das erste Mal ist immer was Besonderes" },
                    5: { title: "Anf√§nger-Chaos ü§¶", text: "5 Mal? Langsam wird's zur Gewohnheit!" },
                    10: { title: "Zehn Finger, zehn Fails üôå", text: "Respekt f√ºr die Best√§ndigkeit!" },
                    25: { title: "Profi-Verlierer üèÜ", text: "Du bist richtig gut darin!" },
                    50: { title: "Halbhundert! üéä", text: "Das Handy l√§uft vor dir weg!" },
                    100: { title: "Jahrhundert-Fail! üéÜ", text: "Legend√§r schlecht organisiert!" }
                };

                if (achievements[newCount]) {
                    setShowAchievement(achievements[newCount]);
                    setTimeout(() => setShowAchievement(null), 3000);
                }
            };

            const handleClick = () => {
                const newCount = count + 1;
                setCount(newCount);
                setHistory([...history, new Date().toISOString()]);
                playSound();
                checkAchievements(newCount);
            };

            const handleUndo = () => {
                if (count > 0) {
                    setCount(count - 1);
                    setHistory(history.slice(0, -1));
                }
            };

            const handleReset = () => {
                if (window.confirm('Wirklich alles zur√ºcksetzen? ü§î')) {
                    setCount(0);
                    setHistory([]);
                }
            };

            const handleInstall = async () => {
                if (!installPrompt) return;
                installPrompt.prompt();
                const { outcome } = await installPrompt.userChoice;
                if (outcome === 'accepted') {
                    setInstallPrompt(null);
                }
            };

            const getStats = () => {
                if (history.length === 0) return null;

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const todayCount = history.filter(date => {
                    const d = new Date(date);
                    d.setHours(0, 0, 0, 0);
                    return d.getTime() === today.getTime();
                }).length;

                const thisWeek = new Date(today);
                thisWeek.setDate(today.getDate() - 7);
                const weekCount = history.filter(date => new Date(date) > thisWeek).length;

                const firstSearch = new Date(history[0]);
                const daysSince = Math.floor((Date.now() - firstSearch.getTime()) / (1000 * 60 * 60 * 24));
                const avgPerDay = daysSince > 0 ? (count / daysSince).toFixed(1) : count;

                return { todayCount, weekCount, avgPerDay, daysSince };
            };

            const stats = getStats();

            return (
                <div style={{ minHeight: '100vh' }}>
                    {installPrompt && (
                        <div className="install-banner">
                            <span>üì± Als App installieren?</span>
                            <button onClick={handleInstall}>Installieren</button>
                        </div>
                    )}

                    <div style={{
                        background: 'linear-gradient(135deg, #FFB6C1 0%, #FFC1E0 100%)',
                        borderRadius: '20px',
                        padding: '30px',
                        textAlign: 'center',
                        boxShadow: '0 8px 32px rgba(0,0,0,0.1)',
                        marginBottom: '20px'
                    }}>
                        <h1 style={{ fontSize: '28px', marginBottom: '10px', color: '#333' }}>
                            üîç Handy Such-Tracker
                        </h1>
                        <p style={{ color: '#666', fontSize: '14px' }}>
                            Wie oft suchst du dein Handy? ü§¶‚Äç‚ôÇÔ∏è
                        </p>
                    </div>

                    <div style={{
                        background: 'white',
                        borderRadius: '20px',
                        padding: '40px',
                        textAlign: 'center',
                        boxShadow: '0 4px 16px rgba(0,0,0,0.1)',
                        marginBottom: '20px',
                        position: 'relative'
                    }}>
                        {showAchievement && (
                            <div style={{
                                position: 'absolute',
                                top: '-20px',
                                left: '50%',
                                transform: 'translateX(-50%)',
                                background: 'linear-gradient(135deg, #FFD700, #FFA500)',
                                padding: '15px 25px',
                                borderRadius: '15px',
                                boxShadow: '0 8px 24px rgba(255,215,0,0.4)',
                                zIndex: 10,
                                animation: 'slideDown 0.3s ease-out'
                            }}>
                                <div style={{ fontWeight: 'bold', fontSize: '16px', color: '#333' }}>
                                    {showAchievement.title}
                                </div>
                                <div style={{ fontSize: '12px', color: '#666', marginTop: '4px' }}>
                                    {showAchievement.text}
                                </div>
                            </div>
                        )}

                        <div style={{
                            fontSize: '120px',
                            fontWeight: 'bold',
                            background: 'linear-gradient(135deg, #FF6B9D, #C44569)',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            marginBottom: '30px'
                        }}>
                            {count}
                        </div>

                        <button
                            onClick={handleClick}
                            style={{
                                background: 'linear-gradient(135deg, #FF6B9D, #C44569)',
                                color: 'white',
                                border: 'none',
                                borderRadius: '50%',
                                width: '180px',
                                height: '180px',
                                fontSize: '24px',
                                fontWeight: 'bold',
                                cursor: 'pointer',
                                boxShadow: '0 8px 24px rgba(255,107,157,0.3)',
                                transition: 'transform 0.1s',
                                marginBottom: '20px'
                            }}
                            onMouseDown={(e) => e.target.style.transform = 'scale(0.95)'}
                            onMouseUp={(e) => e.target.style.transform = 'scale(1)'}
                            onMouseLeave={(e) => e.target.style.transform = 'scale(1)'}
                        >
                            Handy gesucht! üîç
                        </button>

                        <div style={{ display: 'flex', gap: '10px', justifyContent: 'center', flexWrap: 'wrap' }}>
                            <button
                                onClick={handleUndo}
                                disabled={count === 0}
                                style={{
                                    background: count === 0 ? '#ddd' : '#FFE5EC',
                                    color: '#333',
                                    border: 'none',
                                    padding: '12px 24px',
                                    borderRadius: '12px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: count === 0 ? 'not-allowed' : 'pointer',
                                    opacity: count === 0 ? 0.5 : 1
                                }}
                            >
                                ‚Ü©Ô∏è R√ºckg√§ngig
                            </button>
                            <button
                                onClick={() => setShowStats(!showStats)}
                                style={{
                                    background: '#E3F2FD',
                                    color: '#333',
                                    border: 'none',
                                    padding: '12px 24px',
                                    borderRadius: '12px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer'
                                }}
                            >
                                üìä Statistik
                            </button>
                            <button
                                onClick={handleReset}
                                style={{
                                    background: '#FFEBEE',
                                    color: '#333',
                                    border: 'none',
                                    padding: '12px 24px',
                                    borderRadius: '12px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer'
                                }}
                            >
                                üóëÔ∏è Reset
                            </button>
                        </div>
                    </div>

                    {showStats && stats && (
                        <div style={{
                            background: 'white',
                            borderRadius: '20px',
                            padding: '30px',
                            boxShadow: '0 4px 16px rgba(0,0,0,0.1)',
                            animation: 'fadeIn 0.3s ease-out'
                        }}>
                            <h2 style={{ marginBottom: '20px', color: '#333' }}>üìä Deine Such-Statistik</h2>
                            <div style={{ display: 'grid', gap: '15px' }}>
                                <StatCard label="Heute gesucht" value={stats.todayCount} emoji="üìÖ" />
                                <StatCard label="Diese Woche" value={stats.weekCount} emoji="üìÜ" />
                                <StatCard label="Durchschnitt/Tag" value={stats.avgPerDay} emoji="üìà" />
                                <StatCard label="Tage seit Tracking-Start" value={stats.daysSince} emoji="‚è∞" />
                            </div>
                        </div>
                    )}

                    <style>{`
                        @keyframes slideDown {
                            from {
                                transform: translateX(-50%) translateY(-40px);
                                opacity: 0;
                            }
                            to {
                                transform: translateX(-50%) translateY(0);
                                opacity: 1;
                            }
                        }
                        @keyframes fadeIn {
                            from { opacity: 0; transform: translateY(20px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                    `}</style>
                </div>
            );
        }

        function StatCard({ label, value, emoji }) {
            return (
                <div style={{
                    background: 'linear-gradient(135deg, #FFF5E4 0%, #FFE5EC 100%)',
                    padding: '20px',
                    borderRadius: '12px',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                }}>
                    <span style={{ fontSize: '16px', color: '#666' }}>{emoji} {label}</span>
                    <span style={{ fontSize: '24px', fontWeight: 'bold', color: '#333' }}>{value}</span>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Create service worker inline
                const swCode = `
                    const CACHE_NAME = 'handy-sucher-v1';
                    const urlsToCache = [
                        '/',
                        'https://unpkg.com/react@18/umd/react.production.min.js',
                        'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js',
                        'https://unpkg.com/@babel/standalone/babel.min.js'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;

                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);

                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('Service Worker registered'))
                    .catch(error => console.log('Service Worker registration failed:', error));
            });
        }
    </script>
</body>
</html>
